<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Functions | The targets R Package User Manual</title>
  <meta name="description" content="In-depth discussion of the major functionality of targets." />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Functions | The targets R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://books.ropensci.org/targets/man/figures/logo.png" />
  <meta property="og:description" content="In-depth discussion of the major functionality of targets." />
  <meta name="github-repo" content="ropensci-books/targets" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Functions | The targets R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth discussion of the major functionality of targets." />
  <meta name="twitter:image" content="https://books.ropensci.org/targets/man/figures/logo.png" />

<meta name="author" content="Will Landau" />
<meta name="author" content="Copyright Eli Lilly and Company" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="man/figures/apple-touch-icon.png" />
  <link rel="shortcut icon" href="man/figures/favicon.ico" type="image/x-icon" />
<link rel="prev" href="performance.html"/>
<link rel="next" href="targets.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150843595-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150843595-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The targets R Package User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#pipeline-tools"><i class="fa fa-check"></i><b>1.2</b> Pipeline tools</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-targets-package"><i class="fa fa-check"></i><b>1.3</b> The <code>targets</code> package</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#about-this-manual"><i class="fa fa-check"></i><b>1.4</b> About this manual</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#what-about-drake"><i class="fa fa-check"></i><b>1.5</b> What about <code>drake</code>?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>2</b> Walkthrough</a>
<ul>
<li class="chapter" data-level="2.1" data-path="walkthrough.html"><a href="walkthrough.html#about-this-example"><i class="fa fa-check"></i><b>2.1</b> About this example</a></li>
<li class="chapter" data-level="2.2" data-path="walkthrough.html"><a href="walkthrough.html#file-structure"><i class="fa fa-check"></i><b>2.2</b> File structure</a></li>
<li class="chapter" data-level="2.3" data-path="walkthrough.html"><a href="walkthrough.html#target-script-file"><i class="fa fa-check"></i><b>2.3</b> Target script file</a></li>
<li class="chapter" data-level="2.4" data-path="walkthrough.html"><a href="walkthrough.html#inspect-the-pipeline"><i class="fa fa-check"></i><b>2.4</b> Inspect the pipeline</a></li>
<li class="chapter" data-level="2.5" data-path="walkthrough.html"><a href="walkthrough.html#run-the-pipeline"><i class="fa fa-check"></i><b>2.5</b> Run the pipeline</a></li>
<li class="chapter" data-level="2.6" data-path="walkthrough.html"><a href="walkthrough.html#changes"><i class="fa fa-check"></i><b>2.6</b> Changes</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="walkthrough.html"><a href="walkthrough.html#change-code"><i class="fa fa-check"></i><b>2.6.1</b> Change code</a></li>
<li class="chapter" data-level="2.6.2" data-path="walkthrough.html"><a href="walkthrough.html#change-data"><i class="fa fa-check"></i><b>2.6.2</b> Change data</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="walkthrough.html"><a href="walkthrough.html#read-metadata"><i class="fa fa-check"></i><b>2.7</b> Read metadata</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>3</b> Debugging</a>
<ul>
<li class="chapter" data-level="3.1" data-path="debugging.html"><a href="debugging.html#error-messages"><i class="fa fa-check"></i><b>3.1</b> Error messages</a></li>
<li class="chapter" data-level="3.2" data-path="debugging.html"><a href="debugging.html#environment-browser"><i class="fa fa-check"></i><b>3.2</b> Environment browser</a></li>
<li class="chapter" data-level="3.3" data-path="debugging.html"><a href="debugging.html#the-debug-option"><i class="fa fa-check"></i><b>3.3</b> The debug option</a></li>
<li class="chapter" data-level="3.4" data-path="debugging.html"><a href="debugging.html#workspaces"><i class="fa fa-check"></i><b>3.4</b> Workspaces</a></li>
<li class="chapter" data-level="3.5" data-path="debugging.html"><a href="debugging.html#tradeoffs"><i class="fa fa-check"></i><b>3.5</b> Tradeoffs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>4</b> Performance</a>
<ul>
<li class="chapter" data-level="4.1" data-path="performance.html"><a href="performance.html#monitoring-the-pipeline"><i class="fa fa-check"></i><b>4.1</b> Monitoring the pipeline</a></li>
<li class="chapter" data-level="4.2" data-path="performance.html"><a href="performance.html#performance-1"><i class="fa fa-check"></i><b>4.2</b> Performance</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>5</b> Functions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="functions.html"><a href="functions.html#problems-with-script-based-workflows"><i class="fa fa-check"></i><b>5.1</b> Problems with script-based workflows</a></li>
<li class="chapter" data-level="5.2" data-path="functions.html"><a href="functions.html#functions-1"><i class="fa fa-check"></i><b>5.2</b> Functions</a></li>
<li class="chapter" data-level="5.3" data-path="functions.html"><a href="functions.html#writing-functions"><i class="fa fa-check"></i><b>5.3</b> Writing functions</a></li>
<li class="chapter" data-level="5.4" data-path="functions.html"><a href="functions.html#functions-in-pipelines"><i class="fa fa-check"></i><b>5.4</b> Functions in pipelines</a></li>
<li class="chapter" data-level="5.5" data-path="functions.html"><a href="functions.html#tracking-changes"><i class="fa fa-check"></i><b>5.5</b> Tracking changes</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="targets.html"><a href="targets.html"><i class="fa fa-check"></i><b>6</b> Target construction</a>
<ul>
<li class="chapter" data-level="6.1" data-path="targets.html"><a href="targets.html#target-names"><i class="fa fa-check"></i><b>6.1</b> Target names</a></li>
<li class="chapter" data-level="6.2" data-path="targets.html"><a href="targets.html#what-a-target-should-do"><i class="fa fa-check"></i><b>6.2</b> What a target should do</a></li>
<li class="chapter" data-level="6.3" data-path="targets.html"><a href="targets.html#how-much-a-target-should-do"><i class="fa fa-check"></i><b>6.3</b> How much a target should do</a></li>
<li class="chapter" data-level="6.4" data-path="targets.html"><a href="targets.html#working-with-tools-outside-r"><i class="fa fa-check"></i><b>6.4</b> Working with tools outside R</a></li>
<li class="chapter" data-level="6.5" data-path="targets.html"><a href="targets.html#side-effects"><i class="fa fa-check"></i><b>6.5</b> Side effects</a></li>
<li class="chapter" data-level="6.6" data-path="targets.html"><a href="targets.html#dependencies"><i class="fa fa-check"></i><b>6.6</b> Dependencies</a></li>
<li class="chapter" data-level="6.7" data-path="targets.html"><a href="targets.html#return-value"><i class="fa fa-check"></i><b>6.7</b> Return value</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="targets.html"><a href="targets.html#saving"><i class="fa fa-check"></i><b>6.7.1</b> Saving</a></li>
<li class="chapter" data-level="6.7.2" data-path="targets.html"><a href="targets.html#hashing"><i class="fa fa-check"></i><b>6.7.2</b> Hashing</a></li>
<li class="chapter" data-level="6.7.3" data-path="targets.html"><a href="targets.html#workaround"><i class="fa fa-check"></i><b>6.7.3</b> Workaround</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>7</b> Packages</a>
<ul>
<li class="chapter" data-level="7.1" data-path="packages.html"><a href="packages.html#loading-and-configuring-r-packages"><i class="fa fa-check"></i><b>7.1</b> Loading and configuring R packages</a></li>
<li class="chapter" data-level="7.2" data-path="packages.html"><a href="packages.html#r-packages-as-projects"><i class="fa fa-check"></i><b>7.2</b> R packages as projects</a></li>
<li class="chapter" data-level="7.3" data-path="packages.html"><a href="packages.html#target-factories"><i class="fa fa-check"></i><b>7.3</b> Target Factories</a></li>
<li class="chapter" data-level="7.4" data-path="packages.html"><a href="packages.html#package-based-invalidation"><i class="fa fa-check"></i><b>7.4</b> Package-based invalidation</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>8</b> Projects</a>
<ul>
<li class="chapter" data-level="8.1" data-path="projects.html"><a href="projects.html#extra-reproducibility"><i class="fa fa-check"></i><b>8.1</b> Extra reproducibility</a></li>
<li class="chapter" data-level="8.2" data-path="projects.html"><a href="projects.html#project-files"><i class="fa fa-check"></i><b>8.2</b> Project files</a></li>
<li class="chapter" data-level="8.3" data-path="projects.html"><a href="projects.html#multiple-projects"><i class="fa fa-check"></i><b>8.3</b> Multiple projects</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="projects.html"><a href="projects.html#create-each-project."><i class="fa fa-check"></i><b>8.3.1</b> Create each project.</a></li>
<li class="chapter" data-level="8.3.2" data-path="projects.html"><a href="projects.html#configure-each-project."><i class="fa fa-check"></i><b>8.3.2</b> Configure each project.</a></li>
<li class="chapter" data-level="8.3.3" data-path="projects.html"><a href="projects.html#run-each-project"><i class="fa fa-check"></i><b>8.3.3</b> Run each project</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="projects.html"><a href="projects.html#interdependent-projects"><i class="fa fa-check"></i><b>8.4</b> Interdependent projects</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="projects.html"><a href="projects.html#config-inheritance"><i class="fa fa-check"></i><b>8.4.1</b> Config inheritance</a></li>
<li class="chapter" data-level="8.4.2" data-path="projects.html"><a href="projects.html#sharing-targets"><i class="fa fa-check"></i><b>8.4.2</b> Sharing targets</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="projects.html"><a href="projects.html#the-config-package"><i class="fa fa-check"></i><b>8.5</b> The config package</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>9</b> Data: storage and memory</a>
<ul>
<li class="chapter" data-level="9.1" data-path="data.html"><a href="data.html#local-data-store"><i class="fa fa-check"></i><b>9.1</b> Local data store</a></li>
<li class="chapter" data-level="9.2" data-path="data.html"><a href="data.html#external-files"><i class="fa fa-check"></i><b>9.2</b> External files</a></li>
<li class="chapter" data-level="9.3" data-path="data.html"><a href="data.html#memory"><i class="fa fa-check"></i><b>9.3</b> Memory</a></li>
<li class="chapter" data-level="9.4" data-path="data.html"><a href="data.html#cloud-storage"><i class="fa fa-check"></i><b>9.4</b> Cloud storage</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="data.html"><a href="data.html#cost"><i class="fa fa-check"></i><b>9.4.1</b> Cost</a></li>
<li class="chapter" data-level="9.4.2" data-path="data.html"><a href="data.html#aws-setup"><i class="fa fa-check"></i><b>9.4.2</b> AWS setup</a></li>
<li class="chapter" data-level="9.4.3" data-path="data.html"><a href="data.html#gcp-setup"><i class="fa fa-check"></i><b>9.4.3</b> GCP setup</a></li>
<li class="chapter" data-level="9.4.4" data-path="data.html"><a href="data.html#usage"><i class="fa fa-check"></i><b>9.4.4</b> Usage</a></li>
<li class="chapter" data-level="9.4.5" data-path="data.html"><a href="data.html#data-version-control"><i class="fa fa-check"></i><b>9.4.5</b> Data version control</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="data.html"><a href="data.html#cleaning-up-local-internal-data-files"><i class="fa fa-check"></i><b>9.5</b> Cleaning up local internal data files</a></li>
<li class="chapter" data-level="9.6" data-path="data.html"><a href="data.html#literate-programming"><i class="fa fa-check"></i><b>9.6</b> Literate programming</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="markdown.html"><a href="markdown.html"><i class="fa fa-check"></i><b>10</b> Literate programming</a>
<ul>
<li class="chapter" data-level="10.1" data-path="markdown.html"><a href="markdown.html#rendering-within-a-target"><i class="fa fa-check"></i><b>10.1</b> Rendering within a target</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="markdown.html"><a href="markdown.html#parameterized-r-markdown"><i class="fa fa-check"></i><b>10.1.1</b> Parameterized R Markdown</a></li>
<li class="chapter" data-level="10.1.2" data-path="markdown.html"><a href="markdown.html#single-parameter-set"><i class="fa fa-check"></i><b>10.1.2</b> Single parameter set</a></li>
<li class="chapter" data-level="10.1.3" data-path="markdown.html"><a href="markdown.html#multiple-parameter-sets"><i class="fa fa-check"></i><b>10.1.3</b> Multiple parameter sets</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="markdown.html"><a href="markdown.html#target-markdown"><i class="fa fa-check"></i><b>10.2</b> Target Markdown</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="markdown.html"><a href="markdown.html#access"><i class="fa fa-check"></i><b>10.2.1</b> Access</a></li>
<li class="chapter" data-level="10.2.2" data-path="markdown.html"><a href="markdown.html#purpose"><i class="fa fa-check"></i><b>10.2.2</b> Purpose</a></li>
<li class="chapter" data-level="10.2.3" data-path="markdown.html"><a href="markdown.html#example"><i class="fa fa-check"></i><b>10.2.3</b> Example</a></li>
<li class="chapter" data-level="10.2.4" data-path="markdown.html"><a href="markdown.html#required-packages"><i class="fa fa-check"></i><b>10.2.4</b> Required packages</a></li>
<li class="chapter" data-level="10.2.5" data-path="markdown.html"><a href="markdown.html#setup"><i class="fa fa-check"></i><b>10.2.5</b> Setup</a></li>
<li class="chapter" data-level="10.2.6" data-path="markdown.html"><a href="markdown.html#globals"><i class="fa fa-check"></i><b>10.2.6</b> Globals</a></li>
<li class="chapter" data-level="10.2.7" data-path="markdown.html"><a href="markdown.html#target-definitions"><i class="fa fa-check"></i><b>10.2.7</b> Target definitions</a></li>
<li class="chapter" data-level="10.2.8" data-path="markdown.html"><a href="markdown.html#pipeline"><i class="fa fa-check"></i><b>10.2.8</b> Pipeline</a></li>
<li class="chapter" data-level="10.2.9" data-path="markdown.html"><a href="markdown.html#output"><i class="fa fa-check"></i><b>10.2.9</b> Output</a></li>
<li class="chapter" data-level="10.2.10" data-path="markdown.html"><a href="markdown.html#conditioning-on-interactive-mode"><i class="fa fa-check"></i><b>10.2.10</b> Conditioning on interactive mode</a></li>
<li class="chapter" data-level="10.2.11" data-path="markdown.html"><a href="markdown.html#tar_interactive"><i class="fa fa-check"></i><b>10.2.11</b> <code>tar_interactive()</code></a></li>
<li class="chapter" data-level="10.2.12" data-path="markdown.html"><a href="markdown.html#tar_toggle"><i class="fa fa-check"></i><b>10.2.12</b> <code>tar_toggle()</code></a></li>
<li class="chapter" data-level="10.2.13" data-path="markdown.html"><a href="markdown.html#chunk-options"><i class="fa fa-check"></i><b>10.2.13</b> Chunk options</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dynamic.html"><a href="dynamic.html"><i class="fa fa-check"></i><b>11</b> Dynamic branching</a>
<ul>
<li class="chapter" data-level="11.1" data-path="dynamic.html"><a href="dynamic.html#branching"><i class="fa fa-check"></i><b>11.1</b> Branching</a></li>
<li class="chapter" data-level="11.2" data-path="dynamic.html"><a href="dynamic.html#about-dynamic-branching"><i class="fa fa-check"></i><b>11.2</b> About dynamic branching</a></li>
<li class="chapter" data-level="11.3" data-path="dynamic.html"><a href="dynamic.html#patterns"><i class="fa fa-check"></i><b>11.3</b> Patterns</a></li>
<li class="chapter" data-level="11.4" data-path="dynamic.html"><a href="dynamic.html#pattern-construction"><i class="fa fa-check"></i><b>11.4</b> Pattern construction</a></li>
<li class="chapter" data-level="11.5" data-path="dynamic.html"><a href="dynamic.html#branch-provenance"><i class="fa fa-check"></i><b>11.5</b> Branch provenance</a></li>
<li class="chapter" data-level="11.6" data-path="dynamic.html"><a href="dynamic.html#testing-patterns"><i class="fa fa-check"></i><b>11.6</b> Testing patterns</a></li>
<li class="chapter" data-level="11.7" data-path="dynamic.html"><a href="dynamic.html#branching-over-files"><i class="fa fa-check"></i><b>11.7</b> Branching over files</a></li>
<li class="chapter" data-level="11.8" data-path="dynamic.html"><a href="dynamic.html#branching-over-rows"><i class="fa fa-check"></i><b>11.8</b> Branching over rows</a></li>
<li class="chapter" data-level="11.9" data-path="dynamic.html"><a href="dynamic.html#iteration"><i class="fa fa-check"></i><b>11.9</b> Iteration</a>
<ul>
<li class="chapter" data-level="11.9.1" data-path="dynamic.html"><a href="dynamic.html#vector-iteration"><i class="fa fa-check"></i><b>11.9.1</b> Vector iteration</a></li>
<li class="chapter" data-level="11.9.2" data-path="dynamic.html"><a href="dynamic.html#list-iteration"><i class="fa fa-check"></i><b>11.9.2</b> List iteration</a></li>
<li class="chapter" data-level="11.9.3" data-path="dynamic.html"><a href="dynamic.html#group-iteration"><i class="fa fa-check"></i><b>11.9.3</b> Group iteration</a></li>
</ul></li>
<li class="chapter" data-level="11.10" data-path="dynamic.html"><a href="dynamic.html#dynamic-branching-performance"><i class="fa fa-check"></i><b>11.10</b> Dynamic branching performance</a></li>
<li class="chapter" data-level="11.11" data-path="dynamic.html"><a href="dynamic.html#batching"><i class="fa fa-check"></i><b>11.11</b> Batching</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="static.html"><a href="static.html"><i class="fa fa-check"></i><b>12</b> Static branching</a>
<ul>
<li class="chapter" data-level="12.1" data-path="static.html"><a href="static.html#branching-1"><i class="fa fa-check"></i><b>12.1</b> Branching</a></li>
<li class="chapter" data-level="12.2" data-path="static.html"><a href="static.html#when-to-use-static-branching"><i class="fa fa-check"></i><b>12.2</b> When to use static branching</a></li>
<li class="chapter" data-level="12.3" data-path="static.html"><a href="static.html#map"><i class="fa fa-check"></i><b>12.3</b> Map</a></li>
<li class="chapter" data-level="12.4" data-path="static.html"><a href="static.html#dynamic-within-static-branching"><i class="fa fa-check"></i><b>12.4</b> Dynamic-within-static branching</a></li>
<li class="chapter" data-level="12.5" data-path="static.html"><a href="static.html#combine"><i class="fa fa-check"></i><b>12.5</b> Combine</a></li>
<li class="chapter" data-level="12.6" data-path="static.html"><a href="static.html#metaprogramming"><i class="fa fa-check"></i><b>12.6</b> Metaprogramming</a></li>
<li class="chapter" data-level="12.7" data-path="static.html"><a href="static.html#hooks"><i class="fa fa-check"></i><b>12.7</b> Hooks</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>13</b> High-performance computing</a>
<ul>
<li class="chapter" data-level="13.1" data-path="hpc.html"><a href="hpc.html#clustermq"><i class="fa fa-check"></i><b>13.1</b> Clustermq</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="hpc.html"><a href="hpc.html#persistent-workers"><i class="fa fa-check"></i><b>13.1.1</b> Persistent workers</a></li>
<li class="chapter" data-level="13.1.2" data-path="hpc.html"><a href="hpc.html#clustermq-installation"><i class="fa fa-check"></i><b>13.1.2</b> Clustermq installation</a></li>
<li class="chapter" data-level="13.1.3" data-path="hpc.html"><a href="hpc.html#clustermq-locally"><i class="fa fa-check"></i><b>13.1.3</b> Clustermq locally</a></li>
<li class="chapter" data-level="13.1.4" data-path="hpc.html"><a href="hpc.html#clustermq-remotely"><i class="fa fa-check"></i><b>13.1.4</b> Clustermq remotely</a></li>
<li class="chapter" data-level="13.1.5" data-path="hpc.html"><a href="hpc.html#clustermq-configuration"><i class="fa fa-check"></i><b>13.1.5</b> Clustermq configuration</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="hpc.html"><a href="hpc.html#future"><i class="fa fa-check"></i><b>13.2</b> Future</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="hpc.html"><a href="hpc.html#transient-workers"><i class="fa fa-check"></i><b>13.2.1</b> Transient workers</a></li>
<li class="chapter" data-level="13.2.2" data-path="hpc.html"><a href="hpc.html#future-installation"><i class="fa fa-check"></i><b>13.2.2</b> Future installation</a></li>
<li class="chapter" data-level="13.2.3" data-path="hpc.html"><a href="hpc.html#future-locally"><i class="fa fa-check"></i><b>13.2.3</b> Future locally</a></li>
<li class="chapter" data-level="13.2.4" data-path="hpc.html"><a href="hpc.html#future-remotely"><i class="fa fa-check"></i><b>13.2.4</b> Future remotely</a></li>
<li class="chapter" data-level="13.2.5" data-path="hpc.html"><a href="hpc.html#future-configuration"><i class="fa fa-check"></i><b>13.2.5</b> Future configuration</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="hpc.html"><a href="hpc.html#advanced"><i class="fa fa-check"></i><b>13.3</b> Advanced</a></li>
<li class="chapter" data-level="13.4" data-path="hpc.html"><a href="hpc.html#cloud-computing"><i class="fa fa-check"></i><b>13.4</b> Cloud computing</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="drake.html"><a href="drake.html"><i class="fa fa-check"></i><b>14</b> What about <code>drake</code>?</a>
<ul>
<li class="chapter" data-level="14.1" data-path="drake.html"><a href="drake.html#why-is-drake-superseded"><i class="fa fa-check"></i><b>14.1</b> Why is <code>drake</code> superseded?</a></li>
<li class="chapter" data-level="14.2" data-path="drake.html"><a href="drake.html#transitioning-to-targets"><i class="fa fa-check"></i><b>14.2</b> Transitioning to <code>targets</code></a></li>
<li class="chapter" data-level="14.3" data-path="drake.html"><a href="drake.html#advantages-of-targets-over-drake"><i class="fa fa-check"></i><b>14.3</b> Advantages of <code>targets</code> over <code>drake</code></a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="drake.html"><a href="drake.html#better-guardrails-by-design"><i class="fa fa-check"></i><b>14.3.1</b> Better guardrails by design</a></li>
<li class="chapter" data-level="14.3.2" data-path="drake.html"><a href="drake.html#enhanced-debugging-support"><i class="fa fa-check"></i><b>14.3.2</b> Enhanced debugging support</a></li>
<li class="chapter" data-level="14.3.3" data-path="drake.html"><a href="drake.html#improved-tracking-of-package-functions"><i class="fa fa-check"></i><b>14.3.3</b> Improved tracking of package functions</a></li>
<li class="chapter" data-level="14.3.4" data-path="drake.html"><a href="drake.html#lighter-friendlier-data-management"><i class="fa fa-check"></i><b>14.3.4</b> Lighter, friendlier data management</a></li>
<li class="chapter" data-level="14.3.5" data-path="drake.html"><a href="drake.html#cloud-storage-1"><i class="fa fa-check"></i><b>14.3.5</b> Cloud storage</a></li>
<li class="chapter" data-level="14.3.6" data-path="drake.html"><a href="drake.html#show-status-of-functions-and-global-objects"><i class="fa fa-check"></i><b>14.3.6</b> Show status of functions and global objects</a></li>
<li class="chapter" data-level="14.3.7" data-path="drake.html"><a href="drake.html#dynamic-branching-with-dplyrgroup_by"><i class="fa fa-check"></i><b>14.3.7</b> Dynamic branching with <code>dplyr::group_by()</code></a></li>
<li class="chapter" data-level="14.3.8" data-path="drake.html"><a href="drake.html#composable-dynamic-branching"><i class="fa fa-check"></i><b>14.3.8</b> Composable dynamic branching</a></li>
<li class="chapter" data-level="14.3.9" data-path="drake.html"><a href="drake.html#improved-parallel-efficiency"><i class="fa fa-check"></i><b>14.3.9</b> Improved parallel efficiency</a></li>
<li class="chapter" data-level="14.3.10" data-path="drake.html"><a href="drake.html#metaprogramming-1"><i class="fa fa-check"></i><b>14.3.10</b> Metaprogramming</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The targets R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Functions<a href="functions.html#functions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><a href="https://github.com/ropensci/targets"><code>targets</code></a> expects users to adopt a function-oriented style of programming. User-defined R functions are essential to express the complexities of data generation, analysis, and reporting. This chapter explains what makes functions useful and how to leverage them in your pipelines. It is based on the example from the <a href="walkthrough.html#walkthrough">walkthrough chapter</a>.</p>
<div id="problems-with-script-based-workflows" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Problems with script-based workflows<a href="functions.html#problems-with-script-based-workflows" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Traditional data analysis projects consist of imperative scripts, often with with numeric prefixes.</p>
<pre><code>01-data.R
02-model.R
03-plot.R</code></pre>
<p>To run the project, the user runs each of the scripts in order.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="functions.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;01-data.R&quot;</span>)</span>
<span id="cb39-2"><a href="functions.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;02-model.R&quot;</span>)</span>
<span id="cb39-3"><a href="functions.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;03-plot.R&quot;</span>)</span></code></pre></div>
<p>Each script executes a different part of the workflow.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="functions.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 01-data.R</span></span>
<span id="cb40-2"><a href="functions.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb40-3"><a href="functions.html#cb40-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="st">&quot;data.csv&quot;</span> <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="functions.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="at">col_types =</span> <span class="fu">cols</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="functions.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Ozone))</span>
<span id="cb40-6"><a href="functions.html#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(data, <span class="st">&quot;data.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="functions.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 02-model.R</span></span>
<span id="cb41-2"><a href="functions.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biglm)</span>
<span id="cb41-3"><a href="functions.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-4"><a href="functions.html#cb41-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data.rds&quot;</span>, <span class="at">col_types =</span> <span class="fu">cols</span>())</span>
<span id="cb41-5"><a href="functions.html#cb41-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> Temp, data) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="functions.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coefficients</span>()</span>
<span id="cb41-7"><a href="functions.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(model, <span class="st">&quot;model.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="functions.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 03-plot.R</span></span>
<span id="cb42-2"><a href="functions.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb42-3"><a href="functions.html#cb42-3" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;model.rds&quot;</span>)</span>
<span id="cb42-4"><a href="functions.html#cb42-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data.rds&quot;</span>)</span>
<span id="cb42-5"><a href="functions.html#cb42-5" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb42-6"><a href="functions.html#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Temp, <span class="at">y =</span> Ozone)) <span class="sc">+</span></span>
<span id="cb42-7"><a href="functions.html#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> model[<span class="dv">1</span>], <span class="at">slope =</span> model[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb42-8"><a href="functions.html#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>(<span class="dv">24</span>)</span>
<span id="cb42-9"><a href="functions.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;plot.png&quot;</span>, plot)</span></code></pre></div>
<p>Although this approach may feel convenient at first, it scales poorly for medium-sized workflows. These <a href="https://en.wikipedia.org/wiki/Imperative_programming">imperative</a> scripts are monolithic, and they grow too large and complicated to understand or maintain.</p>
</div>
<div id="functions-1" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Functions<a href="functions.html#functions-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Functions are the building blocks of most computer code. They make code easier to think about, and they break down complicated ideas into small manageable pieces. Out of context, you can develop and test a function in isolation without mentally juggling the rest of the project. In the context of the whole workflow, functions are convenient shorthand to make your work easier to read.</p>
<p>In addition, functions are a nice mental model to express data science. A data analysis workflow is a sequence of transformations: datasets map to analyses, and analyses map to summaries. In fact, a function for data science typically falls into one of three categories:</p>
<ol style="list-style-type: decimal">
<li>Process a dataset.</li>
<li>Analyze a dataset.</li>
<li>Summarize an analysis.</li>
</ol>
<p>The example from the <a href="walkthrough.html#walkthrough">walkthrough chapter</a> is a simple instance of this structure.</p>
</div>
<div id="writing-functions" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Writing functions<a href="functions.html#writing-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let us begin with our <a href="https://en.wikipedia.org/wiki/Imperative_programming">imperative</a> code for data processing. Every time you look at it, you need to read it carefully and relearn what it does. And test it, you need to copy the entire block into the R console.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="functions.html#cb43-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="st">&quot;data.csv&quot;</span> <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="functions.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="at">col_types =</span> <span class="fu">cols</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="functions.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Ozone))</span></code></pre></div>
<p>It is better to encapsulate this code in a function.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="functions.html#cb44-1" aria-hidden="true" tabindex="-1"></a>get_data <span class="ot">&lt;-</span> <span class="cf">function</span>(file) {</span>
<span id="cb44-2"><a href="functions.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(file, <span class="at">col_types =</span> <span class="fu">cols</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="functions.html#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="functions.html#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Ozone))</span>
<span id="cb44-5"><a href="functions.html#cb44-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now, instead of invoking a whole block of text, all you need to do is type a small reusable command. The function name speaks for itself, so you can recall what it does without having to mentally process all the details again.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="functions.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_data</span>(<span class="st">&quot;data.csv&quot;</span>)</span></code></pre></div>
<p>As with the data, we can write a function to fit a model,</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="functions.html#cb46-1" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb46-2"><a href="functions.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(Ozone <span class="sc">~</span> Temp, data) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="functions.html#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coefficients</span>()</span>
<span id="cb46-4"><a href="functions.html#cb46-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>and another function to plot the model against the data.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="functions.html#cb47-1" aria-hidden="true" tabindex="-1"></a>plot_model <span class="ot">&lt;-</span> <span class="cf">function</span>(model, data) {</span>
<span id="cb47-2"><a href="functions.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb47-3"><a href="functions.html#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Temp, <span class="at">y =</span> Ozone)) <span class="sc">+</span></span>
<span id="cb47-4"><a href="functions.html#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> model[<span class="dv">1</span>], <span class="at">slope =</span> model[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb47-5"><a href="functions.html#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_gray</span>(<span class="dv">24</span>)</span>
<span id="cb47-6"><a href="functions.html#cb47-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="functions-in-pipelines" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Functions in pipelines<a href="functions.html#functions-in-pipelines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Without those functions, our pipeline in the <a href="walkthrough.html#walkthrough">walkthrough chapter</a> would look long, complicated, and difficult to digest.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="functions.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb48-2"><a href="functions.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb48-3"><a href="functions.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;R/functions.R&quot;</span>)</span>
<span id="cb48-4"><a href="functions.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;tibble&quot;</span>, <span class="st">&quot;readr&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>))</span>
<span id="cb48-5"><a href="functions.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb48-6"><a href="functions.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(file, <span class="st">&quot;data.csv&quot;</span>, <span class="at">format =</span> <span class="st">&quot;file&quot;</span>),</span>
<span id="cb48-7"><a href="functions.html#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb48-8"><a href="functions.html#cb48-8" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb48-9"><a href="functions.html#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(file, <span class="at">col_types =</span> <span class="fu">cols</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb48-10"><a href="functions.html#cb48-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Ozone))</span>
<span id="cb48-11"><a href="functions.html#cb48-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb48-12"><a href="functions.html#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb48-13"><a href="functions.html#cb48-13" aria-hidden="true" tabindex="-1"></a>    model,</span>
<span id="cb48-14"><a href="functions.html#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(Ozone <span class="sc">~</span> Temp, data) <span class="sc">%&gt;%</span></span>
<span id="cb48-15"><a href="functions.html#cb48-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coefficients</span>()</span>
<span id="cb48-16"><a href="functions.html#cb48-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb48-17"><a href="functions.html#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb48-18"><a href="functions.html#cb48-18" aria-hidden="true" tabindex="-1"></a>    plot,</span>
<span id="cb48-19"><a href="functions.html#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb48-20"><a href="functions.html#cb48-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Temp, <span class="at">y =</span> Ozone)) <span class="sc">+</span></span>
<span id="cb48-21"><a href="functions.html#cb48-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> model[<span class="dv">1</span>], <span class="at">slope =</span> model[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb48-22"><a href="functions.html#cb48-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_gray</span>(<span class="dv">24</span>)</span>
<span id="cb48-23"><a href="functions.html#cb48-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-24"><a href="functions.html#cb48-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>But if we write our functions in <code>R/functions.R</code> and <code>source()</code> them into the target script file (default: <code>_targets.R</code>) the pipeline becomes much easier to read. We can even condense out <code>raw_data</code> and <code>data</code> targets together without creating a large command.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="functions.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _targets.R</span></span>
<span id="cb49-2"><a href="functions.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb49-3"><a href="functions.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;R/functions.R&quot;</span>)</span>
<span id="cb49-4"><a href="functions.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(<span class="at">packages =</span> <span class="fu">c</span>(<span class="st">&quot;tibble&quot;</span>, <span class="st">&quot;readr&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>))</span>
<span id="cb49-5"><a href="functions.html#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb49-6"><a href="functions.html#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(file, <span class="st">&quot;data.csv&quot;</span>, <span class="at">format =</span> <span class="st">&quot;file&quot;</span>),</span>
<span id="cb49-7"><a href="functions.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(data, <span class="fu">get_data</span>(file)),</span>
<span id="cb49-8"><a href="functions.html#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(model, <span class="fu">fit_model</span>(data)),</span>
<span id="cb49-9"><a href="functions.html#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(plot, <span class="fu">plot_model</span>(model, data))</span>
<span id="cb49-10"><a href="functions.html#cb49-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="tracking-changes" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Tracking changes<a href="functions.html#tracking-changes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To help figure out which targets to rerun and which ones to skip, the <code>targets</code> package tracks changes to the functions you define. To track changes to a function, <code>targets</code> computes a <a href="https://en.wikipedia.org/wiki/Hash_function">hash</a>. This hash fingerprints the <a href="https://adv-r.hadley.nz/expressions.html#parsing">deparsed</a> function (body and arguments) together with the hashes of all global functions and objects called that function. So if the functions body, arguments, or dependencies change nontrivially, that change will be detected.</p>
<p>This hashing system is not perfect. For example, functions created by <code>Rcpp::cppFunction()</code> do not show the state of the underlying C++ code. As a workaround, you can use a wrapper that inserts the C++ code into the R function body so <code>targets</code> can track it for meaningful changes.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="functions.html#cb50-1" aria-hidden="true" tabindex="-1"></a>cpp_function <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb50-2"><a href="functions.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> Rcpp<span class="sc">::</span><span class="fu">cppFunction</span>(code)</span>
<span id="cb50-3"><a href="functions.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">body</span>(out) <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">call2</span>(<span class="st">&quot;{&quot;</span>, code, <span class="fu">body</span>(out))</span>
<span id="cb50-4"><a href="functions.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb50-5"><a href="functions.html#cb50-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-6"><a href="functions.html#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="functions.html#cb50-7" aria-hidden="true" tabindex="-1"></a>your_function <span class="ot">&lt;-</span> <span class="fu">cpp_function</span>(</span>
<span id="cb50-8"><a href="functions.html#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;int your_function(int x, int y, int z) {</span></span>
<span id="cb50-9"><a href="functions.html#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="st">     int sum = x + y + z;</span></span>
<span id="cb50-10"><a href="functions.html#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="st">     return sum;</span></span>
<span id="cb50-11"><a href="functions.html#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="st">   }&quot;</span></span>
<span id="cb50-12"><a href="functions.html#cb50-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Functions produced by <code>Vectorize()</code> and <code>purrr::safely()</code> suffer similar issues because the actual function code is in the closure of the function instead of the body. In addition, functions from packages are not automatically tracked, and <a href="https://books.ropensci.org/targets/packages.html#package-based-invalidation">extra steps documented in the packages chapter</a> are required to enable this.</p>
<p>It is impossible to eliminate every edge case, so before running the pipeline, please <a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html">run the dependency graph</a> and <a href="https://docs.ropensci.org/targets/reference/index.html#inspect">other utilities</a> to check your understanding of the state of project.</p>

</div>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="performance.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="targets.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ropensci-books/targets/edit/main/functions.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/ropensci-books/targets/commits/main/functions.Rmd",
"text": "Chapter edit history"
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
